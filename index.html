<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAIJU RUSH: Evolution</title>
    <style>
        /* ESTILOS BASE E INTERFAZ */
        body {
            margin: 0; overflow: hidden; background-color: #87CEEB;
            font-family: 'Arial Black', 'Arial Bold', sans-serif;
            touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent;
        }
        #game-container { position: relative; width: 100%; height: 100vh; }
        canvas { display: block; width: 100%; height: 100%; }

        /* UI SUPERIOR (Nivel y XP) */
        #top-ui {
            position: absolute; top: 10px; left: 10px; right: 10px;
            display: flex; flex-direction: column; gap: 5px; pointer-events: none;
        }
        .stat-bar-container {
            background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 15px;
            color: white; display: flex; align-items: center;
        }
        #level-badge {
            background: #f1c40f; color: #2c3e50; width: 40px; height: 40px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 20px; border: 3px solid white; margin-right: 10px; box-shadow: 0 4px 0 #c27c0e;
        }
        #xp-progress-bg { flex-grow: 1; height: 20px; background: #34495e; border-radius: 10px; overflow: hidden; position: relative;}
        #xp-progress-fill { height: 100%; width: 0%; background: linear-gradient(to right, #2ecc71, #00b894); transition: width 0.3s; }
        #xp-text { position: absolute; width: 100%; text-align: center; top: 0; line-height: 20px; font-size: 12px; text-shadow: 1px 1px 2px black;}
        #score { font-size: 24px; color: white; text-shadow: 3px 3px 0 #000; margin-top: 5px;}

        /* PANTALLA DE MEJORAS (LEVEL UP) */
        #upgrade-screen {
            display: none; /* Oculto al inicio */
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 50;
            flex-direction: column; justify-content: center; align-items: center;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; }}
        #upgrade-screen h2 { color: #f1c40f; font-size: 36px; text-shadow: 3px 3px 0 #e67e22; margin-bottom: 30px; text-align: center;}
        .upgrade-card {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            width: 80%; max-width: 300px; margin: 10px; padding: 20px;
            border-radius: 20px; border: 4px solid white; color: white;
            text-align: center; cursor: pointer; box-shadow: 0 8px 0 #1a5276;
            transform: scale(1); transition: transform 0.1s;
        }
        .upgrade-card:active { transform: scale(0.95); box-shadow: 0 4px 0 #1a5276; }
        .card-icon { font-size: 50px; margin-bottom: 10px; }
        .card-title { font-size: 20px; margin-bottom: 5px; color: #f1c40f;}
        .card-desc { font-size: 14px; }

        /* PANTALLA INICIO */
        #start-screen {
             position: absolute; top: 0; left: 0; width: 100%; height: 100%;
             background: rgba(0,0,0,0.7); color: white; display: flex;
             flex-direction: column; justify-content: center; align-items: center; z-index: 40;
        }
        .big-btn {
            background: #e74c3c; border: none; padding: 20px 40px; font-size: 28px; color: white;
            border-radius: 50px; border: 4px solid white; font-family: inherit;
            box-shadow: 0 10px 0 #c0392b; cursor: pointer; animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); }}
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="top-ui">
            <div class="stat-bar-container">
                <div id="level-badge">1</div>
                <div id="xp-progress-bg">
                    <div id="xp-progress-fill"></div>
                    <div id="xp-text">XP: 0 / 10</div>
                </div>
            </div>
            <div id="score">üèÜ Puntos: 0</div>
        </div>

        <div id="start-screen">
            <h1 style="font-size: 50px; color: #f1c40f; text-shadow: 4px 4px 0 black; text-align: center;">KAIJU RUSH<br>EVOLUTION</h1>
            <p style="font-size: 20px;">¬°TOCA R√ÅPIDO PARA DESTRUIR!</p>
            <button class="big-btn" onclick="startGame()">¬°EMPEZAR!</button>
        </div>

        <div id="upgrade-screen">
            <h2>¬°SUBISTE DE NIVEL!</h2>
            <p style="color:white;">Elige una mejora:</p>
            <div id="cards-container">
                </div>
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN Y VARIABLES GLOBALES ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let canvasWidth, canvasHeight;
        
        let gameState = {
            running: false, paused: false,
            score: 0, level: 1, xp: 0, xpToNextLevel: 10,
            gameSpeed: 4, frame: 0
        };

        // EL MONSTRUO ü¶ñ
        let monster = {
            x: 50, yBase: 0, y: 0, size: 110, emoji: "ü¶ñ",
            attackPower: 1, // Da√±o por golpe
            attackRange: 120, // Qu√© tan lejos pega
            hasFire: false, // Mejora de fuego
            hasMegaBoom: false, // Mejora de explosi√≥n grande
            isAttacking: false, attackCooldown: 0
        };

        let buildings = [];
        let particles = []; // Efectos visuales y textos flotantes
        let shakeIntensity = 0; // Para el temblor de pantalla

        // --- BASE DE DATOS DE MEJORAS ---
        const upgradePool = [
            {id: 'big_size', icon: 'üçÑ', title: '¬°CRECER!', desc: 'Tama√±o +20%. Rango de ataque aumenta.'},
            {id: 'more_power', icon: 'üí™', title: 'FUERZA BRUTA', desc: 'Da√±o de ataque +1. Destruye m√°s r√°pido.'},
            {id: 'fire_breath', icon: 'üî•', title: 'ALIENTO DE FUEGO', desc: 'Tus ataques queman a los edificios cercanos.'},
            {id: 'fast_legs', icon: '‚ö°', title: 'VELOCIDAD', desc: 'El juego va m√°s r√°pido (M√°s puntos).'},
            {id: 'mega_boom', icon: 'üí£', title: 'MEGA PISOT√ìN', desc: 'Tus golpes crean explosiones gigantes.'}
        ];

        // --- INICIO Y BUCLE PRINCIPAL ---
        function resizeCanvas() {
            canvasWidth = window.innerWidth; canvasHeight = window.innerHeight;
            canvas.width = canvasWidth; canvas.height = canvasHeight;
            monster.yBase = canvasHeight - 150;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            gameState.running = true; gameLoop();
        }

        function gameLoop() {
            if (!gameState.running || gameState.paused) return;

            // Temblor de pantalla
            let shakeX = 0, shakeY = 0;
            if(shakeIntensity > 0) {
                shakeX = (Math.random()-0.5)*shakeIntensity; shakeY = (Math.random()-0.5)*shakeIntensity;
                shakeIntensity *= 0.9; // Reduce el temblor
                if(shakeIntensity < 0.5) shakeIntensity = 0;
            }

            ctx.setTransform(1, 0, 0, 1, shakeX, shakeY); // Aplicar temblor
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // DIBUJAR FONDO
            ctx.fillStyle = "#87CEEB"; ctx.fillRect(0, 0, canvasWidth, canvasHeight); // Cielo
            ctx.fillStyle = "#2ecc71"; ctx.fillRect(0, canvasHeight - 60, canvasWidth, 60); // Pasto

            // LOGICA DEL JUEGO
            updateMonster();
            updateBuildings();
            updateParticles();
            gameState.frame++;

            ctx.setTransform(1, 0, 0, 1, 0, 0); // Resetear temblor
            requestAnimationFrame(gameLoop);
        }

        // --- L√ìGICA DEL MONSTRUO Y ATAQUE ---
        function updateMonster() {
            // Animaci√≥n simple de correr
            monster.y = monster.yBase + Math.sin(gameState.frame * 0.15) * 10;
            
            // Dibujar monstruo (con sombra)
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.font = `${monster.size}px Arial`; ctx.textAlign = "center";
            ctx.fillText(monster.emoji, monster.x + monster.size/2 + 5, monster.y + monster.size + 5); // Sombra

            ctx.fillStyle = "#000";
            ctx.fillText(monster.emoji, monster.x + monster.size/2, monster.y + monster.size);

            // Cooldown de ataque visual
            if(monster.attackCooldown > 0) {
                monster.attackCooldown--;
                if(monster.attackCooldown <= 0) { monster.emoji = "ü¶ñ"; monster.isAttacking = false; }
            }
        }

        // DETECTAR EL TAP/CLIC PARA ATACAR
        canvas.addEventListener('pointerdown', performAttack);

        function performAttack(e) {
            if(gameState.paused || !gameState.running) return;

            monster.isAttacking = true;
            monster.emoji = monster.hasFire ? "üê≤" : "ü¶ï"; // Cambia emoji al atacar
            monster.attackCooldown = 10; // Duraci√≥n visual del ataque

            // Efectos visuales del golpe
            shakeIntensity = 15; // SACUDIDA FUERTE
            if(monster.hasMegaBoom) createExplosion(monster.x + monster.attackRange, canvasHeight-80, "üí•", 100);

            let hitSomething = false;
            // Chequear colisi√≥n con edificios en el rango de ataque
            buildings.forEach(b => {
                if(!b.destroyed && b.x < monster.x + monster.attackRange && b.x > monster.x - 50) {
                    // GOLPE DIRECTO
                    let damage = monster.attackPower;
                    if(monster.hasFire) damage += 1; // Bonus de fuego
                    
                    b.health -= damage;
                    hitSomething = true;
                    
                    // Texto de da√±o flotante
                    createFloatingText(`-${damage}`, b.x + b.size/2, b.y, "#e74c3c", 30);

                    if(b.health <= 0) {
                        destroyBuilding(b);
                    } else {
                         // Efecto de golpe sin destruir
                        createExplosion(b.x+b.size/2, b.y+b.size/2, "üí®", 40);
                    }
                }
            });
            
            // Si ten√©s fuego, da√±a un poco a los que est√°n m√°s lejos
            if(monster.hasFire && hitSomething) {
                 buildings.forEach(b => {
                    if(!b.destroyed && b.x > monster.x + monster.attackRange && b.x < monster.x + monster.attackRange + 150) {
                         b.health -= 0.5; // Da√±o quemadura
                         createFloatingText("üî•", b.x + b.size/2, b.y - 20, "#e67e22", 20);
                         if(b.health<=0) destroyBuilding(b);
                    }
                 });
            }
        }

        function destroyBuilding(b) {
            b.destroyed = true;
            // EFECTOS JUGOSOS
            shakeIntensity = 25; // Sacudida extra fuerte
            createExplosion(b.x + b.size/2, b.y + b.size/2, monster.hasFire ? "üî•" : "üß±", b.size);
            if(monster.hasMegaBoom) createExplosion(b.x + b.size/2, b.y, "üí£", b.size*1.5);

            // RECOMPENSAS
            let xpGain = b.maxHealth * 2;
            gameState.score += b.maxHealth * 10;
            gainXP(xpGain);
            createFloatingText(`+${xpGain} XP!`, b.x + b.size/2, b.y - 50, "#f1c40f", 40); // Texto de XP grande

            // Aumentar velocidad un poquito
            gameState.gameSpeed += 0.02;
        }


        // --- L√ìGICA DE EDIFICIOS ---
        function updateBuildings() {
             // Generar
            if (gameState.frame % Math.floor(120/gameState.gameSpeed) === 0) {
                let types = [{e:"üè¢", h:3}, {e:"üè†", h:1}, {e:"üè•", h:5}, {e:"üèØ", h:8}];
                let t = types[Math.floor(Math.random() * types.length)];
                buildings.push({
                    x: canvasWidth, y: canvasHeight - 70, type: t.e, size: 80 + t.h*5,
                    health: t.h, maxHealth: t.h, destroyed: false
                });
            }
            // Mover y Dibujar
            for (let i = 0; i < buildings.length; i++) {
                let b = buildings[i];
                b.x -= gameState.gameSpeed;
                
                let drawEmoji = b.destroyed ? (monster.hasFire ? "üî•" : "üí©") : b.type;
                let drawSize = b.destroyed ? b.size/1.5 : b.size;
                
                // Dibujar edificio
                ctx.font = `${drawSize}px Arial`; ctx.textAlign = "center";
                ctx.fillText(drawEmoji, b.x + b.size/2, b.y + b.size);

                // Barra de vida del edificio (si est√° da√±ado)
                if(!b.destroyed && b.health < b.maxHealth) {
                    ctx.fillStyle = "red"; ctx.fillRect(b.x, b.y, b.size, 10);
                    ctx.fillStyle = "green"; ctx.fillRect(b.x, b.y, b.size * (b.health/b.maxHealth), 10);
                }

                if (b.x < -150) { buildings.splice(i, 1); i--; }
            }
        }

        // --- SISTEMA DE PROGRESI√ìN (XP y NIVEL) ---
        function gainXP(amount) {
            gameState.xp += amount;
            if(gameState.xp >= gameState.xpToNextLevel) {
                levelUp();
            }
            updateUI();
        }

        function levelUp() {
            gameState.level++;
            gameState.xp = 0;
            gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5); // Cuesta m√°s subir
            
            gameState.paused = true; // PAUSAR JUEGO
            showUpgradeScreen();
        }

        function updateUI() {
            document.getElementById('score').innerText = "üèÜ Puntos: " + gameState.score;
            document.getElementById('level-badge').innerText = gameState.level;
            let xpPercent = (gameState.xp / gameState.xpToNextLevel) * 100;
            document.getElementById('xp-progress-fill').style.width = xpPercent + "%";
            document.getElementById('xp-text').innerText = `XP: ${gameState.xp} / ${gameState.xpToNextLevel}`;
        }

        // --- SISTEMA DE MEJORAS (UPGRADES) ---
        function showUpgradeScreen() {
            const container = document.getElementById('cards-container');
            container.innerHTML = ''; // Limpiar cartas viejas
            
            // Elegir 3 mejoras al azar
            let choices = [];
            let poolCopy = [...upgradePool];
            for(let i=0; i<3; i++) {
                if(poolCopy.length === 0) break;
                let randomIndex = Math.floor(Math.random() * poolCopy.length);
                choices.push(poolCopy[randomIndex]);
                // Si es una mejora √∫nica (como fuego), sacarla del pool para no repetirla
                if(['fire_breath', 'mega_boom'].includes(poolCopy[randomIndex].id)) {
                     poolCopy.splice(randomIndex, 1);
                }
            }

            choices.forEach(upgrade => {
                let card = document.createElement('div');
                card.className = 'upgrade-card';
                card.innerHTML = `<div class="card-icon">${upgrade.icon}</div><div class="card-title">${upgrade.title}</div><div class="card-desc">${upgrade.desc}</div>`;
                card.onclick = () => applyUpgrade(upgrade);
                container.appendChild(card);
            });

            document.getElementById('upgrade-screen').style.display = 'flex';
        }

        function applyUpgrade(upgrade) {
            document.getElementById('upgrade-screen').style.display = 'none';
            
            // APLICAR LOS EFECTOS
            switch(upgrade.id) {
                case 'big_size': monster.size *= 1.2; monster.attackRange *= 1.2; break;
                case 'more_power': monster.attackPower += 1; break;
                case 'fire_breath': monster.hasFire = true; break;
                case 'mega_boom': monster.hasMegaBoom = true; break;
                case 'fast_legs': gameState.gameSpeed += 1; break;
            }
            
            // Eliminar mejoras √∫nicas del pool principal si ya se obtuvieron
            if(upgrade.id === 'fire_breath' || upgrade.id === 'mega_boom') {
                 let idx = upgradePool.findIndex(u => u.id === upgrade.id);
                 if(idx > -1) upgradePool.splice(idx, 1);
            }

            // Efecto visual de level up
            createExplosion(canvasWidth/2, canvasHeight/2, "üÜô", 200);
            gameState.paused = false; // REANUDAR JUEGO
            gameLoop();
        }


        // --- EFECTOS VISUALES (PART√çCULAS Y TEXTO) ---
        function createExplosion(x, y, icon, size) {
            for(let i=0; i<15; i++) {
                particles.push({
                    x: x, y: y, type: 'particle', icon: icon, size: size/2 + Math.random()*size/2,
                    vx: (Math.random()-0.5)*20, vy: (Math.random()-1)*20 - 5,
                    life: 30, gravity: 1
                });
            }
        }
        function createFloatingText(text, x, y, color, size) {
             particles.push({
                x: x, y: y, type: 'text', text: text, color: color, size: size,
                vx: 0, vy: -3, life: 40, gravity: 0
            });
        }

        function updateParticles() {
            for(let i=0; i<particles.length; i++) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.life--;
                ctx.globalAlpha = p.life / 40; // Desvanecer

                if(p.type === 'particle') {
                     ctx.font = `${p.size}px Arial`; ctx.textAlign = "center";
                     ctx.fillText(p.icon, p.x, p.y);
                } else if (p.type === 'text') {
                     ctx.fillStyle = p.color; ctx.font = `bold ${p.size}px Arial`; ctx.textAlign = "center";
                     ctx.fillText(p.text, p.x, p.y);
                     ctx.strokeStyle = "black"; ctx.lineWidth = 2; ctx.strokeText(p.text, p.x, p.y);
                }
                
                if(p.life <= 0) { particles.splice(i, 1); i--; }
            }
            ctx.globalAlpha = 1;
        }
    </script>
</body>
</html>